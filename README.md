# Тестовое задание Java/Kotlin trainee Krainet
## **Важно! перед запуском программы дочитайте ReadMe файл до конца.**

### Необходимо реализовать систему из двух микросервисов:

AUTH 
Функционал: авторизация, аутентификация, CRUD для работы с аккаунтам пользователя (создать, посмотреть, удалить пользователя). Использовать: Java/Kotlin, Spring Boot, Spring Security, Hibernate, Spring Data JPA, FlyWay/Liquibase, любая SQL БД. 
Пример возможной модели пользователя:
- username
- password
- email
- firstName
- lastName
- role (Например: USER/ADMIN)

NOTIFICATION
Функционал: Отправка уведомлений на почту. Использовать: Java/Kotlin, Spring Boot. 

Доступы:
USER - Может создать (регистрация), удалить, просмотреть и изменить только свой аккаунт.
ADMIN - Может изменить, удалить, просмотреть данные любого аккаунта. 

При создании/изменении/удалении пользователя без привилегий (USER) нужно отправить сообщение на почту всем привилегированным пользователям (ADMIN) такого типа:

Тема: Создан/Изменен/Удален пользователь {username}.
Текст: Создан/Изменен/Удален пользователь с именем - {username}, паролем - {password} и почтой - {email}. 



Требования:

1. Реализация CRUD RESTful операций посредством Spring Boot.
2. Реализовать общение между микровервисами любым способом и быть готовым обосновать свой выбор.
3. Реализовать логирование.
4. Миграции структуры данных (Flyway или Liquibase).
5. Авторизация запросов посредством Spring Security и JWT.
6. Разделение на роли в Spring Security (USER, ADMIN).
7. Сборка приложения с помощью maven.
8. Развёртывание микросервисов и базы данных в Docker с использованием Docker compose.
9. Написать README, по которому можно запустить систему.
10. При проверке в БД уже должны быть тестовые данные.
11. Чистый код и использование SOLID принципов.

___

### Запуск программы

**Важно!**
По умолчанию для рассылки писем используется моя почта , но из за слишком частых рассылок со стороны моей почты в последнее время - письма могут попадать в спам или восприниматься подозрительная активность не доходить вовсе. ***Рекомендуемый вариант - поменять почту , с которой происходит рассылка писем всем админам.*** 

**Инструкция по запуску программы**
1. Откройте папку Krainet в любой интегрированной среде разработки (IDE), например, IntelliJ IDEA.
2. После открытия проекта откройте файл docker-compose.yaml. Внутри файла для сервиса notification вам необходимо в переменных: MAIL_USERNAME и MAIL_PASSWORD указать следующие значения:
*  **MAIL_USERNAME** : адрес электронной почты, который будет использоваться для отправки писем.
* **MAIL_PASSWORD** :  это не пароль от почтового ящика, а специальный пароль для SMTP, который может быть сгенерирован в настройках вашего почтового провайдера (например, Yandex) для использования с внешними приложениями.
3. Откройте встроенный терминал в IDE.
4. В терминале введите команду: ```docker compose down``` и дождитесь завершения удаления старых контейнеров.
5. В этом же терминале введите команду: ```docker compose up -d``` и дождитесь завершения сборки всех новых контейнеров.
6. Программа запущена!


___
### Тестирование программы

В файле User system operation requests.postman_collection - находятся все необходимые endpoints для создания/редактирования/удаления пользователя с ролью USER. 
**Внимание!** в самом первом Http запросе - вам необходимо указать почту на которую будут приходить уведомления.

Подробнее о всех endpoints можно узнать по адресу : ```http://localhost:8080/swagger-ui.html```


* Аутентификация происходит при помощи JWT токенов.
* Если вы используете Postman - Auth Type : Bearer Token.
* В целях безопасности, все пароли хэшируются , узнать пароль может админ - при регистрации нового пользователя его пароль не хэшируется.
* Для того , чтобы зарегистрировать пользователя с ролью "ADMIN" - вам необходимо добавить поле JSON: "key_for_admin" : "X8JGxLy8" . Это также работает при редактировании пользователя.
  
___
### Перечень использованых технологий 
* Java 23
* Spring Boot: версия 3.5.4
* JPA
* PostgreSQL
* Flyway
* Log4j
* Lombok
* MapStruct
* Jackson
* JWT (JSON Web Token)
* Apache Kafka